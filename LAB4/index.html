<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì¸í”„ë° ì˜í™” ì •ë³´ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  <div class="container">

    <header class="site-header">
      <h1 class="site-title">ì¸í”„ë° ì˜í™” ì •ë³´ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.</h1>
      <nav class="site-nav">
        <a href="index.html" class="active">ë©”ì¸í˜ì´ì§€</a>
        <a href="login.html">ë¡œê·¸ì¸</a>
        <a href="signup.html">íšŒì›ê°€ì…</a>
      </nav>
    </header>
    <hr />

    <div class="search-wrapper">
      <input
        type="text"
        id="searchInput"
        placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”."
        aria-label="ì˜í™” ê²€ìƒ‰"
      />
      <button id="filterBtn">Filter results</button>
    </div>

    <main class="main-content">
      <aside class="sort-panel">
        <fieldset>
          <legend>ì •ë ¬ ê¸°ì¤€</legend>
          <label><input type="radio" name="sort" value="rating-desc" checked> í‰ì  ë‚´ë¦¼ì°¨ìˆœ</label>
          <label><input type="radio" name="sort" value="rating-asc"> í‰ì  ì˜¤ë¦„ì°¨ìˆœ</label>
          <label><input type="radio" name="sort" value="date-desc"> ê°œë´‰ ë‚´ë¦¼ì°¨ìˆœ</label>
          <label><input type="radio" name="sort" value="date-asc"> ê°œë´‰ ì˜¤ë¦„ì°¨ìˆœ</label>
        </fieldset>
      </aside>

      <section id="movieGrid" class="movie-grid">

      </section>
    </main>

    <div id="loading" class="loading">ë¡œë”© ì¤‘â€¦</div>

    <footer class="site-footer">
      Â© 2021147573 ì´í˜„ë¹ˆ
    </footer>
  </div>

  <script>
    const initialLoad = 9, perPage = 3, container = document.getElementById('movieGrid');
    let movies = [], filtered = [], currentIndex = 0, isFirstLoad = true;

    function renderMovies(count) {
      const endIndex = Math.min(currentIndex + count, filtered.length);
      const slice = filtered.slice(currentIndex, endIndex);
      
      slice.forEach(m => {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
          <img src="${m.poster_path}" alt="${m.title} í¬ìŠ¤í„°"/>
          <div class="info">
            <h2>${m.title}</h2>
            <small>ğŸ“… ${m.release_date || 'â€”'}</small>
            <p>â­ ${m.vote_average}</p>
          </div>
          <div class="overlay"><p>${m.overview||'ì¤„ê±°ë¦¬ ì—†ìŒ'}</p></div>
        `;
        container.appendChild(card);
      });
      
      currentIndex = endIndex;
    }

    function loadInitial() {
      renderMovies(initialLoad);
      isFirstLoad = false;
    }

    function loadMore() {
      if (!isFirstLoad) {
        renderMovies(perPage);
      }
    }

    function applyFilters() {
      const kw = document.getElementById('searchInput').value.trim().toLowerCase();
      filtered = movies.filter(m => m.title.toLowerCase().includes(kw));

      const sortVal = document.querySelector('input[name=sort]:checked').value;
      const [key, ord] = sortVal.split('-');
      filtered.sort((a,b)=>{
        let va, vb;
        if (key === 'rating') {
          va = +a.vote_average;
          vb = +b.vote_average;
        } else {
          va = a.release_date || '0000-00-00';
          vb = b.release_date || '0000-00-00';
        }
        return ord==='asc'? (va<vb?-1:1) : (va>vb?-1:1);
      });
      
      currentIndex = 0;
      isFirstLoad = true;
      container.innerHTML = '';
      loadInitial();
    }

    document.getElementById('filterBtn').addEventListener('click', applyFilters);
    document.querySelectorAll('input[name=sort]')
      .forEach(r=> r.addEventListener('change', applyFilters));

    window.addEventListener('scroll', ()=>{
      if(window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 100){
        if(currentIndex < filtered.length) {
          loadMore();
        }
      }
    });

	fetch('product.json')
      .then(res=> res.json())
      .then(data=>{
        movies = data;
        filtered = [...movies];

              const sortVal = document.querySelector('input[name=sort]:checked').value;
      const [key, ord] = sortVal.split('-');
      filtered.sort((a,b)=>{
        let va, vb;
        if (key === 'rating') {
          va = +a.vote_average;
          vb = +b.vote_average;
        } else {
          va = a.release_date || '0000-00-00';
          vb = b.release_date || '0000-00-00';
        }
        return ord==='asc'? (va<vb?-1:1) : (va>vb?-1:1);
      });
        
        document.getElementById('loading').style.display='none';
        loadInitial();
      })
      .catch(e=>{
        document.getElementById('loading').textContent='ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜';
        console.error(e);
      });
  </script>
</body>
</html>
